# -- docker compose configuration for peruvian sales web
# -- uses modern compose specification (no version field)

services:
  # -- main web application
  web:
    container_name: ${CONTAINER_NAME:-peruvian-sales-web}
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - NODE_ENV=${NODE_ENV:-production}
        - SITE_URL=${SITE_URL:-https://peruviansales.pe}
    image: peruvian-sales-web:${IMAGE_TAG:-latest}
    restart: unless-stopped
    ports:
      - "${CONTAINER_PORT:-4321}:4321"
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - HOST=${HOST:-0.0.0.0}
      - PORT=${PORT:-4321}
      - SITE_URL=${SITE_URL:-https://peruviansales.pe}
      - SITE_NAME=${SITE_NAME:-PERUVIAN SALES AND SERVICES CORPORATION S.A.C.}
      - CONTACT_PHONE=${CONTACT_PHONE:-+51 999 999 999}
      - CONTACT_EMAIL=${CONTACT_EMAIL:-ventas@peruviansales.pe}
      - CONTACT_WHATSAPP=${CONTACT_WHATSAPP:-51999999999}
    networks:
      - peruvian-sales-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:4321/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    labels:
      - "com.peruviansales.description=Corporate website for Peruvian Sales"
      - "com.peruviansales.maintainer=dev@peruviansales.pe"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# -- networks configuration
networks:
  peruvian-sales-network:
    name: ${NETWORK_NAME:-peruvian-sales-network}
    driver: bridge
